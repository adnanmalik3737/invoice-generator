import React, { useState, useRef } from "react";
import Popup from "reactjs-popup";
import ImageUploader from "./FileUpload";
import SignaturePad from "react-signature-canvas";

function SignaturePopup() {
  const [imageURL, setImageURL] = useState(null); // create a state that will contain our image url

  const sigCanvas = useRef({});

  // Toggle the body class when the popup is opened or closed
  const toggleBodyDarkened = (active) => {
    if (active) {
      document.body.classList.add("body-darkened");
    } else {
      document.body.classList.remove("body-darkened");
    }
  };

  /* a function that uses the canvas ref to clear the canvas 
  via a method given by react-signature-canvas */
  const clear = () => sigCanvas.current.clear();

  /* a function that uses the canvas ref to trim the canvas 
  from white spaces via a method given by react-signature-canvas
  then saves it in our state */
  //   const save = () =>
  //     setImageURL(sigCanvas.current.getTrimmedCanvas().toDataURL("image/png"));

  const save = (close) => {
    setImageURL(sigCanvas.current.getTrimmedCanvas().toDataURL("image/png"));
    close(); // Close the popup
  };
  return (
    <div className="">
      {/* <Popup
        modal
        trigger={<button>Add +</button>}
        closeOnDocumentClick={false}
      > */}

      <Popup
        modal
        trigger={
          <button
            className="addSignBtn"
            // onClick={() => toggleBodyDarkened(true)}
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="15"
              viewBox="0 0 16 15"
              fill="none"
            >
              <path
                d="M7.80176 1.65625V7.65625M7.80176 7.65625V13.6562M7.80176 7.65625H13.8018M7.80176 7.65625H1.80176"
                stroke="white"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>
        }
        closeOnDocumentClick={false}
        // onOpen={() => toggleBodyDarkened(true)} // Add this line
        // onClose={() => toggleBodyDarkened(false)} // Add this line
      >
        {(close) => (
          <div className="signatureInput">
            <button onClick={close} className="signCloseBtn">
              {" "}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="11"
                height="11"
                viewBox="0 0 11 11"
                fill="white"
              >
                <path
                  d="M1.51855 9.55225L9.51855 1.55225M1.51855 1.55225L9.51855 9.55225"
                  stroke="#111"
                  stroke-width="1.33333"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <SignaturePad
              ref={sigCanvas}
              canvasProps={{
                className: "signatureCanvas",
              }}
            />

            <div className="signatureBtns">
              <button className="signatureBtn uploadsignBtn">
                <span className="uploadSignImg">
                  <span className="uploadIcon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="25"
                      height="25"
                      viewBox="0 0 25 25"
                      fill="none"
                    >
                      <path
                        d="M16.2282 12.1351C16.0436 12.3197 15.7932 12.4234 15.5321 12.4234C15.271 12.4234 15.0206 12.3197 14.836 12.1351L13.0848 10.3834V16.4959C13.0848 16.757 12.981 17.0074 12.7964 17.192C12.6118 17.3766 12.3615 17.4803 12.1004 17.4803C11.8393 17.4803 11.5889 17.3766 11.4043 17.192C11.2197 17.0074 11.116 16.757 11.116 16.4959V10.3834L9.36429 12.1351C9.27293 12.2268 9.16439 12.2995 9.04489 12.3492C8.92539 12.3989 8.79727 12.4245 8.66786 12.4246C8.53844 12.4247 8.41028 12.3993 8.2907 12.3498C8.17111 12.3003 8.06246 12.2278 7.97095 12.1363C7.87944 12.0448 7.80687 11.9361 7.7574 11.8165C7.70792 11.6969 7.68251 11.5688 7.68262 11.4394C7.68272 11.3099 7.70835 11.1818 7.75802 11.0623C7.80769 10.9428 7.88044 10.8343 7.9721 10.7429L11.4043 7.31075C11.5889 7.12616 11.8393 7.02246 12.1004 7.02246C12.3615 7.02246 12.6118 7.12616 12.7965 7.31075L16.2282 10.7429C16.4128 10.9276 16.5165 11.178 16.5165 11.439C16.5165 11.7001 16.4128 11.9505 16.2282 12.1351Z"
                        fill="white"
                      />
                      <path
                        d="M20.8397 19.0358C20.7616 19.1389 20.6638 19.2257 20.5521 19.2911C20.4404 19.3564 20.3169 19.3991 20.1887 19.4167C20.0605 19.4343 19.9301 19.4264 19.8049 19.3935C19.6797 19.3606 19.5623 19.3034 19.4592 19.225C19.3562 19.1467 19.2696 19.0488 19.2045 18.937C19.1394 18.8251 19.0969 18.7016 19.0796 18.5733C19.0622 18.445 19.0704 18.3146 19.1035 18.1895C19.1366 18.0644 19.1941 17.9471 19.2727 17.8442C20.586 16.1112 21.2277 13.9613 21.0791 11.792C20.9306 9.6226 20.0018 7.58031 18.4645 6.04248C14.9559 2.53295 9.2461 2.53248 5.73657 6.04107C4.19907 7.5786 3.27001 9.62064 3.12103 11.7899C2.97205 13.9592 3.61323 16.109 4.9261 17.8423C5.00463 17.9452 5.06211 18.0625 5.09525 18.1877C5.12838 18.3128 5.13651 18.4432 5.11918 18.5714C5.10185 18.6997 5.0594 18.8233 4.99425 18.9351C4.92911 19.0469 4.84255 19.1448 4.73953 19.2232C4.6365 19.3015 4.51904 19.3587 4.39387 19.3916C4.2687 19.4245 4.13827 19.4324 4.01004 19.4148C3.88182 19.3972 3.75832 19.3545 3.64662 19.2892C3.53492 19.2238 3.4372 19.1371 3.35907 19.0339C2.12542 17.4067 1.37045 15.4675 1.17912 13.4345C0.987797 11.4015 1.36772 9.35543 2.27612 7.52665C3.18452 5.69786 4.58534 4.15893 6.3209 3.08307C8.05647 2.00721 10.0579 1.43713 12.0998 1.43701H12.1013C14.1433 1.43736 16.1448 2.0077 17.8803 3.08384C19.6158 4.15998 21.0165 5.69918 21.9246 7.5282C22.8328 9.35721 23.2124 11.4034 23.0207 13.4365C22.8291 15.4695 22.0737 17.4087 20.8397 19.0358Z"
                        fill="white"
                      />
                      <path
                        d="M23.0225 22.2847C23.0224 22.5457 22.9187 22.7961 22.7341 22.9807C22.5495 23.1653 22.2991 23.269 22.0381 23.269H2.16309C1.90201 23.269 1.65163 23.1653 1.46703 22.9807C1.28242 22.7961 1.17871 22.5457 1.17871 22.2847C1.17871 22.0236 1.28242 21.7732 1.46703 21.5886C1.65163 21.404 1.90201 21.3003 2.16309 21.3003H22.0381C22.2991 21.3003 22.5495 21.4041 22.7341 21.5887C22.9187 21.7733 23.0224 22.0236 23.0225 22.2847Z"
                        fill="white"
                      />
                    </svg>
                  </span>
                  <span className="uploadText">Upload</span>
                </span>
              </button>

              {/* <div className="itemHeader">
                <ImageUploader
                  inputId="upload-logo-3"
                  uploadUrl="YOUR_URL_3"
                  onImageChange={(imageData) => {}}
                />
              </div> */}

              <button className="signatureBtn clearBtn" onClick={clear}>
                <span className="uploadSignImg">
                  <span className="uploadIcon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="25"
                      height="25"
                      viewBox="0 0 25 25"
                      fill="#333;"
                    >
                      <path
                        d="M16.2282 12.1351C16.0436 12.3197 15.7932 12.4234 15.5321 12.4234C15.271 12.4234 15.0206 12.3197 14.836 12.1351L13.0848 10.3834V16.4959C13.0848 16.757 12.981 17.0074 12.7964 17.192C12.6118 17.3766 12.3615 17.4803 12.1004 17.4803C11.8393 17.4803 11.5889 17.3766 11.4043 17.192C11.2197 17.0074 11.116 16.757 11.116 16.4959V10.3834L9.36429 12.1351C9.27293 12.2268 9.16439 12.2995 9.04489 12.3492C8.92539 12.3989 8.79727 12.4245 8.66786 12.4246C8.53844 12.4247 8.41028 12.3993 8.2907 12.3498C8.17111 12.3003 8.06246 12.2278 7.97095 12.1363C7.87944 12.0448 7.80687 11.9361 7.7574 11.8165C7.70792 11.6969 7.68251 11.5688 7.68262 11.4394C7.68272 11.3099 7.70835 11.1818 7.75802 11.0623C7.80769 10.9428 7.88044 10.8343 7.9721 10.7429L11.4043 7.31075C11.5889 7.12616 11.8393 7.02246 12.1004 7.02246C12.3615 7.02246 12.6118 7.12616 12.7965 7.31075L16.2282 10.7429C16.4128 10.9276 16.5165 11.178 16.5165 11.439C16.5165 11.7001 16.4128 11.9505 16.2282 12.1351Z"
                        fill="#333"
                      />
                      <path
                        d="M20.8397 19.0358C20.7616 19.1389 20.6638 19.2257 20.5521 19.2911C20.4404 19.3564 20.3169 19.3991 20.1887 19.4167C20.0605 19.4343 19.9301 19.4264 19.8049 19.3935C19.6797 19.3606 19.5623 19.3034 19.4592 19.225C19.3562 19.1467 19.2696 19.0488 19.2045 18.937C19.1394 18.8251 19.0969 18.7016 19.0796 18.5733C19.0622 18.445 19.0704 18.3146 19.1035 18.1895C19.1366 18.0644 19.1941 17.9471 19.2727 17.8442C20.586 16.1112 21.2277 13.9613 21.0791 11.792C20.9306 9.6226 20.0018 7.58031 18.4645 6.04248C14.9559 2.53295 9.2461 2.53248 5.73657 6.04107C4.19907 7.5786 3.27001 9.62064 3.12103 11.7899C2.97205 13.9592 3.61323 16.109 4.9261 17.8423C5.00463 17.9452 5.06211 18.0625 5.09525 18.1877C5.12838 18.3128 5.13651 18.4432 5.11918 18.5714C5.10185 18.6997 5.0594 18.8233 4.99425 18.9351C4.92911 19.0469 4.84255 19.1448 4.73953 19.2232C4.6365 19.3015 4.51904 19.3587 4.39387 19.3916C4.2687 19.4245 4.13827 19.4324 4.01004 19.4148C3.88182 19.3972 3.75832 19.3545 3.64662 19.2892C3.53492 19.2238 3.4372 19.1371 3.35907 19.0339C2.12542 17.4067 1.37045 15.4675 1.17912 13.4345C0.987797 11.4015 1.36772 9.35543 2.27612 7.52665C3.18452 5.69786 4.58534 4.15893 6.3209 3.08307C8.05647 2.00721 10.0579 1.43713 12.0998 1.43701H12.1013C14.1433 1.43736 16.1448 2.0077 17.8803 3.08384C19.6158 4.15998 21.0165 5.69918 21.9246 7.5282C22.8328 9.35721 23.2124 11.4034 23.0207 13.4365C22.8291 15.4695 22.0737 17.4087 20.8397 19.0358Z"
                        fill="#333"
                      />
                      <path
                        d="M23.0225 22.2847C23.0224 22.5457 22.9187 22.7961 22.7341 22.9807C22.5495 23.1653 22.2991 23.269 22.0381 23.269H2.16309C1.90201 23.269 1.65163 23.1653 1.46703 22.9807C1.28242 22.7961 1.17871 22.5457 1.17871 22.2847C1.17871 22.0236 1.28242 21.7732 1.46703 21.5886C1.65163 21.404 1.90201 21.3003 2.16309 21.3003H22.0381C22.2991 21.3003 22.5495 21.4041 22.7341 21.5887C22.9187 21.7733 23.0224 22.0236 23.0225 22.2847Z"
                        fill="#333"
                      />
                    </svg>
                  </span>
                  <span className="uploadText">Clear</span>
                </span>
              </button>
              <button
                className="signatureBtn saveBtn"
                onClick={() => save(close)}
              >
                <span className="uploadSignImg">
                  <span className="uploadIcon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="25"
                      height="25"
                      viewBox="0 0 25 25"
                      fill="#009bd6"
                    >
                      <path
                        d="M16.2282 12.1351C16.0436 12.3197 15.7932 12.4234 15.5321 12.4234C15.271 12.4234 15.0206 12.3197 14.836 12.1351L13.0848 10.3834V16.4959C13.0848 16.757 12.981 17.0074 12.7964 17.192C12.6118 17.3766 12.3615 17.4803 12.1004 17.4803C11.8393 17.4803 11.5889 17.3766 11.4043 17.192C11.2197 17.0074 11.116 16.757 11.116 16.4959V10.3834L9.36429 12.1351C9.27293 12.2268 9.16439 12.2995 9.04489 12.3492C8.92539 12.3989 8.79727 12.4245 8.66786 12.4246C8.53844 12.4247 8.41028 12.3993 8.2907 12.3498C8.17111 12.3003 8.06246 12.2278 7.97095 12.1363C7.87944 12.0448 7.80687 11.9361 7.7574 11.8165C7.70792 11.6969 7.68251 11.5688 7.68262 11.4394C7.68272 11.3099 7.70835 11.1818 7.75802 11.0623C7.80769 10.9428 7.88044 10.8343 7.9721 10.7429L11.4043 7.31075C11.5889 7.12616 11.8393 7.02246 12.1004 7.02246C12.3615 7.02246 12.6118 7.12616 12.7965 7.31075L16.2282 10.7429C16.4128 10.9276 16.5165 11.178 16.5165 11.439C16.5165 11.7001 16.4128 11.9505 16.2282 12.1351Z"
                        fill="#009bd6"
                      />
                      <path
                        d="M20.8397 19.0358C20.7616 19.1389 20.6638 19.2257 20.5521 19.2911C20.4404 19.3564 20.3169 19.3991 20.1887 19.4167C20.0605 19.4343 19.9301 19.4264 19.8049 19.3935C19.6797 19.3606 19.5623 19.3034 19.4592 19.225C19.3562 19.1467 19.2696 19.0488 19.2045 18.937C19.1394 18.8251 19.0969 18.7016 19.0796 18.5733C19.0622 18.445 19.0704 18.3146 19.1035 18.1895C19.1366 18.0644 19.1941 17.9471 19.2727 17.8442C20.586 16.1112 21.2277 13.9613 21.0791 11.792C20.9306 9.6226 20.0018 7.58031 18.4645 6.04248C14.9559 2.53295 9.2461 2.53248 5.73657 6.04107C4.19907 7.5786 3.27001 9.62064 3.12103 11.7899C2.97205 13.9592 3.61323 16.109 4.9261 17.8423C5.00463 17.9452 5.06211 18.0625 5.09525 18.1877C5.12838 18.3128 5.13651 18.4432 5.11918 18.5714C5.10185 18.6997 5.0594 18.8233 4.99425 18.9351C4.92911 19.0469 4.84255 19.1448 4.73953 19.2232C4.6365 19.3015 4.51904 19.3587 4.39387 19.3916C4.2687 19.4245 4.13827 19.4324 4.01004 19.4148C3.88182 19.3972 3.75832 19.3545 3.64662 19.2892C3.53492 19.2238 3.4372 19.1371 3.35907 19.0339C2.12542 17.4067 1.37045 15.4675 1.17912 13.4345C0.987797 11.4015 1.36772 9.35543 2.27612 7.52665C3.18452 5.69786 4.58534 4.15893 6.3209 3.08307C8.05647 2.00721 10.0579 1.43713 12.0998 1.43701H12.1013C14.1433 1.43736 16.1448 2.0077 17.8803 3.08384C19.6158 4.15998 21.0165 5.69918 21.9246 7.5282C22.8328 9.35721 23.2124 11.4034 23.0207 13.4365C22.8291 15.4695 22.0737 17.4087 20.8397 19.0358Z"
                        fill="#009bd6"
                      />
                      <path
                        d="M23.0225 22.2847C23.0224 22.5457 22.9187 22.7961 22.7341 22.9807C22.5495 23.1653 22.2991 23.269 22.0381 23.269H2.16309C1.90201 23.269 1.65163 23.1653 1.46703 22.9807C1.28242 22.7961 1.17871 22.5457 1.17871 22.2847C1.17871 22.0236 1.28242 21.7732 1.46703 21.5886C1.65163 21.404 1.90201 21.3003 2.16309 21.3003H22.0381C22.2991 21.3003 22.5495 21.4041 22.7341 21.5887C22.9187 21.7733 23.0224 22.0236 23.0225 22.2847Z"
                        fill="#009bd6"
                      />
                    </svg>
                  </span>
                  <span className="uploadText">Save</span>
                </span>
              </button>
            </div>
          </div>
        )}
      </Popup>
      <br />
      <br />
      {/* if our we have a non-null image url we should 
      show an image and pass our imageURL state to it*/}
      {imageURL ? (
        <img className="signatureImage" src={imageURL} alt="signature" />
      ) : null}
    </div>
  );
}

export default SignaturePopup;
